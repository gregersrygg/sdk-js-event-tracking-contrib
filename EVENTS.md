# Events generated by JS-Snippet

## Introduction to the sub-objects

The events generated by the JS-SDK uses several sub-objects, some of them always present, while others are only used for certain types of events.

`@context` - This should always be present. It declares that the event is created in the context of SPT, and says something about type and version of the API.

`@id` - A unique ID for the object. `@id` is also used inside sub-objects like `actor`, `object` and `provider`. The `@id` always refer to the closest parent.

`@type` - The Activity Type or the Object Type. (Object Type if placed inside a sub-object). The type indicates the type of the activity or the type of the object.

`published` - The timestamp for when the activity was created.

`spt:pageViewId` - Not a official Activitystream object, but this is a unique ID (UUIDv4) for an page view. Can be used to group all events generated from a single page view.

`actor` - The actor object contains information about the user. The full actor object is available in the page load object, while other events uses a reduced actor.

`provider` - The organization that runs the service/site where the tracking takes place.

`object` - The object is the entity that generates the activity. If the activity has the type `Read` (page load event), the `object` will be the page that are loaded.

`result` - The result object is the outcome of the activity. So if a user submits a form, the object will be the form, while the result will be whatever the user submits.

`origin` - The entity where the object originated. If a user submits a form, the object will be the form, while the page where the form was found will be the origin.

## Page load

Page loads use the Activity Type `Read`. The `object` is the entity that are loaded.

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "2a3e79df-62e0-49c9-af9f-f3be11fa356f",
"spt:pageViewId": "23a3155a-31e0-4399-907d-8ad6066ed405",
"published": "2015-03-26T13:26:31+01:00",
"actor": {
    "@type": "Person",
    "spt:userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.104 Safari/537.36",
    "spt:screenSize": "1680x1050",
    "spt:viewportSize": "1313x502",
    "spt:acceptLanguage": "en-US",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:f0ccaba92013d32562ddce1105c3f70710af9e3b7e13009776ab746352b569b8",
    "spt:sessionId": "urn:spid.no:session:58d87b82-2518-45fd-a884-8b13157d7abe",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:2",
    "url": "http://127.0.0.1:8082/vg.html"
},
"@type": "Read",
"object": {
    "@type": "Page",
    "@id": "urn:127.0.0.1:page:1",
    "url": "http://127.0.0.1:8082/vg.html",
    "displayName": "Etterforskningsleder: Venter første svarene fra dødsflyets «svarte boks» i ettermiddag - Germanwings-styrten - VG",
    "spt:og": {
        ...
    },
    "spt:meta": {
        ...
    }
}
```

## Page Unload

Two events are generated on page unload. Please note that not all Page Unload events will be tracked, depending on factors such as page unload method and connection speed.

The first event is based on engagement time, it has the Activity Type `View` and a property `duration` that contains the time in milliseconds the user visited the page. The object here is the subject for the event. In other words the page that the user is leaving.

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "502ee66e-369c-44ed-874e-e0848163c259",
"spt:pageViewId": "edbf9842-b125-4c31-b63f-57388c20a5a1",
"published": "2015-04-20T13:05:28+02:00",
"actor": {
    "@type": "Person",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:ec1df2d7d600247e67ec30ddfc26bf170c09dd782196939639be9f7d101f10ed",
    "spt:sessionId": "urn:spid.no:session:8c11e4aa-f6f1-43ec-a68b-63dab9e5c7aa",
    "spt:userId": "urn:spid.no:user:test123123",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:test",
    "url": "http://127.0.0.1:8082/index2.html"
},
"@type": "View",
"object": {
    "@type": "Page",
    "@id": "urn:127.0.0.1:page:test01",
    "url": "http://127.0.0.1:8082/index2.html",
    "displayName": "My first test site"
},
"duration": 8359
```

The second event is a event that indicates that the user has left the page. It uses the Activity Type `Leave` and `object` is the page that the user left. If the user left by clicking an a-element, there will be a `target`-object present that indicates where the user are going.

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "aa2f8ef5-19c4-4aaf-8a46-f0c1976ac0fe",
"spt:pageViewId": "edbf9842-b125-4c31-b63f-57388c20a5a1",
"published": "2015-04-20T13:05:28+02:00",
"actor": {
    "@type": "Person",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:ec1df2d7d600247e67ec30ddfc26bf170c09dd782196939639be9f7d101f10ed",
    "spt:sessionId": "urn:spid.no:session:8c11e4aa-f6f1-43ec-a68b-63dab9e5c7aa",
    "spt:userId": "urn:spid.no:user:test123123",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:test",
    "url": "http://127.0.0.1:8082/index2.html"
},
"@type": "Leave",
"object": {
    "@type": "Page",
    "@id": "urn:127.0.0.1:page:test01",
    "url": "http://127.0.0.1:8082/index2.html",
    "displayName": "My first test site"
},
"target": {
    "@id": "urn:127.0.0.1:page:test01"
}

```

## Scroll tracking

The JS-Snippet will track scrolling in 25% intervals. The Activity Type is `Arrive` and the relative distance of the scroll depth will are found in the `result`-object.

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "df9836de-4494-4afb-a9a6-4bf82b16f90a",
"spt:pageViewId": "23a3155a-31e0-4399-907d-8ad6066ed405",
"published": "2015-03-26T13:39:49+01:00",
"actor": {
    "@type": "Person",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:f0ccaba92013d32562ddce1105c3f70710af9e3b7e13009776ab746352b569b8",
    "spt:sessionId": "urn:spid.no:session:58d87b82-2518-45fd-a884-8b13157d7abe",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:2",
    "url": "http://127.0.0.1:8082/vg.html"
},
"@type": "Arrive",
"object": {
    "@type": "Page",
    "@id": "urn:127.0.0.1:page:1",
    "url": "http://127.0.0.1:8082/vg.html",
    "displayName": "Etterforskningsleder: Venter første svarene fra dødsflyets «svarte boks» i ettermiddag - Germanwings-styrten - VG"
},
"result": {
    "@type": "Place",
    "@id": "urn:127.0.0.1:page:1:scroll:25",
    "spt:depth": 25
}
```

## Visibility tracking

If `.track-visibility` is present on any element, an activity will be generated whenever that element enters or exits the viewport.

When an element enters the viewport, a `View`-type activity is generated. Please note that the `origin` is the page here, and that `object` is the element that entered viewport. A timestamp is included in `object` to indicate the time that the element entered the viewport.

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "1640a37d-b40e-4385-9b5d-b8ae60c8a125",
"spt:pageViewId": "3ccb53a7-2e51-4608-9c5e-efcd81e449ab",
"published": "2015-04-20T15:36:56+02:00",
"actor": {
    "@type": "Person",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:ec1df2d7d600247e67ec30ddfc26bf170c09dd782196939639be9f7d101f10ed",
    "spt:sessionId": "urn:spid.no:session:8c11e4aa-f6f1-43ec-a68b-63dab9e5c7aa",
    "spt:userId": "urn:spid.no:user:test123123",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:test",
    "url": "http://127.0.0.1:8082/index2.html"
},
"@type": "View",
"origin": {
    "@type": "Page",
    "@id": "urn:127.0.0.1:page:test01",
    "url": "http://127.0.0.1:8082/index2.html",
    "displayName": "My first test site"
},
"object": {
    "@type": "Content",
    "@id": "urn:127.0.0.1:page:test01:element:testAd01",
    "startTime": "2015-04-20T15:36:56+02:00"
}
```

As soon as the element exits the viewport, a similar event is generated. But an `endTime`-property is now included in the `object`.

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "ea0743eb-50e2-42bd-8875-0915b705b7c3",
"spt:pageViewId": "3ccb53a7-2e51-4608-9c5e-efcd81e449ab",
"published": "2015-04-20T15:46:20+02:00",
"actor": {
    "@type": "Person",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:ec1df2d7d600247e67ec30ddfc26bf170c09dd782196939639be9f7d101f10ed",
    "spt:sessionId": "urn:spid.no:session:8c11e4aa-f6f1-43ec-a68b-63dab9e5c7aa",
    "spt:userId": "urn:spid.no:user:test123123",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:test",
    "url": "http://127.0.0.1:8082/index2.html"
},
"@type": "View",
"origin": {
    "@type": "Page",
    "@id": "urn:127.0.0.1:page:test01",
    "url": "http://127.0.0.1:8082/index2.html",
    "displayName": "My first test site"
},
"object": {
    "@type": "Content",
    "@id": "urn:127.0.0.1:page:test01:element:testAd01",
    "startTime": "2015-04-20T15:36:56+02:00",
    "endTime": "2015-04-20T15:46:20+02:00"
}
```

## Click tracking

If the class `.track-click` is present in any element, the activity below will be generated whenever the element is clicked. Activity Type is `Accept` and there is a `target`-object present that represents the target of the element (or the element itself if no target is set).

```
"@context": [
    "http://www.w3.org/ns/activitystreams",
    {
        "spt": "http://spid.no",
        "spt:sdkType": "JS",
        "spt:sdkVersion": "0.1.0"
    }
],
"@id": "5b23dd19-0b8f-432a-8afe-272b80249d89",
"spt:pageViewId": "51f689cf-378d-4c12-a505-e2f954153c0c",
"published": "2015-04-20T15:28:36+02:00",
"actor": {
    "@type": "Person",
    "@id": "urn:spid.no:person:a77e5b92-e6ee-4552-a207-ecc35b7e688a",
    "spt:environmentId": "urn:spid.no:environment:ec1df2d7d600247e67ec30ddfc26bf170c09dd782196939639be9f7d101f10ed",
    "spt:sessionId": "urn:spid.no:session:8c11e4aa-f6f1-43ec-a68b-63dab9e5c7aa",
    "spt:userId": "urn:spid.no:user:test123123",
    "spt:remoteAddress": "127.0.0.1"
},
"provider": {
    "@type": "Organization",
    "@id": "urn:spid.no:test",
    "url": "http://127.0.0.1:8082/index2.html"
},
"@type": "Accept",
"object": {
    "@id": "urn:127.0.0.1:page:test01:element:button01",
    "@type": "Link"
},
"target": {
    "@id": "urn:127.0.0.1:page:test01"
}
```
